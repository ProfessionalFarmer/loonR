# 因为我们后续过滤了很长的isoforms，所以这个地方要继续过滤一下
# 先找到过滤之前的transcript id和tracking id的对应关系，然后过滤class.stat，因为这个里面还有tracking id
gff <- read_gff("/data/home2/Zhongxu/work/cuhk-crc/analysis/04gtfprocessing/all.1.cuffcompare.combined.gtf")
gff <- gff %>% filter(oId %in% gsub("ALL-","",candidate.remove)) %>% select(oId,transcript_id)
gff <- data.frame(gff, stringsAsFactors = FALSE)
gff <- unique(gff[,c("oId","transcript_id")]) # transcript id就是tracking id
# perform filter
class.stat <- class.stat %>% filter(! Tracking %in% gff$transcript_id)
# done
# convert CRC001N.39 to CRC001N
class.stat$Sample <- sapply(strsplit(class.stat$Sample,"\\."),function(x) paste(x[1]))
View(class.stat)
candidate.remove
CRC001N <- as.vector( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Tracking) )
CRC001T <- as.vector( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Tracking) )
CRC003T <- as.vector( class.stat %>% filter(Sample %in% c("CRC003T") ) %>% select(Tracking) )
CRC006T <- as.vector( class.stat %>% filter(Sample %in% c("CRC006T") ) %>% select(Tracking) )
CRC007T <- as.vector( class.stat %>% filter(Sample %in% c("CRC007T") ) %>% select(Tracking) )
CRC008N <- as.vector( class.stat %>% filter(Sample %in% c("CRC008N") ) %>% select(Tracking) )
CRC010N <- as.vector( class.stat %>% filter(Sample %in% c("CRC010N") ) %>% select(Tracking) )
upset_plot <- function(list){
lm <- ComplexHeatmap::list_to_matrix(   list           )
m = ComplexHeatmap::make_comb_mat(lm, remove_complement_set = TRUE, mode = "distinct")
ht = draw(UpSet(m))
od = column_order(ht)
cs = comb_size(m)
decorate_annotation("Intersection\nsize", {
grid.text(cs[od], x = seq_along(cs), y = unit(cs[od], "native") + unit(2, "pt"),
default.units = "native", just = "bottom", gp = gpar(fontsize = 8))
})
upset(  fromList(    list(Normal=unique(normal), Tumor=unique(tumor))   ),
text.scale = 1.5 , mb.ratio= c(0.6,0.4))
}
upset_plot( list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N ) )
list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )
upset_plot <- function(plot.list){
lm <- ComplexHeatmap::list_to_matrix(   plot.list           )
m = ComplexHeatmap::make_comb_mat(lm, remove_complement_set = TRUE, mode = "distinct")
ht = draw(UpSet(m))
od = column_order(ht)
cs = comb_size(m)
decorate_annotation("Intersection\nsize", {
grid.text(cs[od], x = seq_along(cs), y = unit(cs[od], "native") + unit(2, "pt"),
default.units = "native", just = "bottom", gp = gpar(fontsize = 8))
})
upset(  fromList(    list(Normal=unique(normal), Tumor=unique(tumor))   ),
text.scale = 1.5 , mb.ratio= c(0.6,0.4))
}
upset_plot( list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N ) )
plot.list =  list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )
lm <- ComplexHeatmap::list_to_matrix(   plot.list           )
CRC001N <- as.vector( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Tracking) )
CRC001T <- as.vector( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Tracking) )
CRC003T <- as.vector( class.stat %>% filter(Sample %in% c("CRC003T") ) %>% select(Tracking) )
CRC006T <- as.vector( class.stat %>% filter(Sample %in% c("CRC006T") ) %>% select(Tracking) )
CRC007T <- as.vector( class.stat %>% filter(Sample %in% c("CRC007T") ) %>% select(Tracking) )
CRC008N <- as.vector( class.stat %>% filter(Sample %in% c("CRC008N") ) %>% select(Tracking) )
CRC010N <- as.vector( class.stat %>% filter(Sample %in% c("CRC010N") ) %>% select(Tracking) )
upset_plot <- function(plot.list){
lm <- ComplexHeatmap::list_to_matrix(   plot.list           )
m = ComplexHeatmap::make_comb_mat(lm, remove_complement_set = TRUE, mode = "distinct")
ht = draw(UpSet(m))
od = column_order(ht)
cs = comb_size(m)
decorate_annotation("Intersection\nsize", {
grid.text(cs[od], x = seq_along(cs), y = unit(cs[od], "native") + unit(2, "pt"),
default.units = "native", just = "bottom", gp = gpar(fontsize = 8))
})
upset(  fromList(    list(Normal=unique(normal), Tumor=unique(tumor))   ),
text.scale = 1.5 , mb.ratio= c(0.6,0.4))
}
upset_plot( list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N ) )
plot.list
plot.list$CRC001N
CRC001N <- ( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Tracking) )$Tracing
CRC001T <- ( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Tracking) )$Tracing
CRC003T <- ( class.stat %>% filter(Sample %in% c("CRC003T") ) %>% select(Tracking) )$Tracing
CRC006T <- ( class.stat %>% filter(Sample %in% c("CRC006T") ) %>% select(Tracking) )$Tracing
CRC007T <- ( class.stat %>% filter(Sample %in% c("CRC007T") ) %>% select(Tracking) )$Tracing
CRC008N <- ( class.stat %>% filter(Sample %in% c("CRC008N") ) %>% select(Tracking) )$Tracing
CRC010N <- ( class.stat %>% filter(Sample %in% c("CRC010N") ) %>% select(Tracking) )$Tracing
upset_plot <- function(plot.list){
lm <- ComplexHeatmap::list_to_matrix(   plot.list           )
m = ComplexHeatmap::make_comb_mat(lm, remove_complement_set = TRUE, mode = "distinct")
ht = draw(UpSet(m))
od = column_order(ht)
cs = comb_size(m)
decorate_annotation("Intersection\nsize", {
grid.text(cs[od], x = seq_along(cs), y = unit(cs[od], "native") + unit(2, "pt"),
default.units = "native", just = "bottom", gp = gpar(fontsize = 8))
})
upset(  fromList(    list(Normal=unique(normal), Tumor=unique(tumor))   ),
text.scale = 1.5 , mb.ratio= c(0.6,0.4))
}
upset_plot( list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N ) )
CRC001N
CRC001N <- c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Tracking) )
CRC001N
CRC001N <- c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Tracking) )
CRC001T <- c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Tracking) )
CRC003T <- c( class.stat %>% filter(Sample %in% c("CRC003T") ) %>% select(Tracking) )
CRC006T <- c( class.stat %>% filter(Sample %in% c("CRC006T") ) %>% select(Tracking) )
CRC007T <- c( class.stat %>% filter(Sample %in% c("CRC007T") ) %>% select(Tracking) )
CRC008N <- c( class.stat %>% filter(Sample %in% c("CRC008N") ) %>% select(Tracking) )
CRC010N <- c( class.stat %>% filter(Sample %in% c("CRC010N") ) %>% select(Tracking) )
upset_plot <- function(plot.list){
plot.list =  list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )
lm <- ComplexHeatmap::list_to_matrix(   plot.list           )
m = ComplexHeatmap::make_comb_mat(lm, remove_complement_set = TRUE, mode = "distinct")
ht = draw(UpSet(m))
od = column_order(ht)
cs = comb_size(m)
decorate_annotation("Intersection\nsize", {
grid.text(cs[od], x = seq_along(cs), y = unit(cs[od], "native") + unit(2, "pt"),
default.units = "native", just = "bottom", gp = gpar(fontsize = 8))
})
upset(  fromList(    list(Normal=unique(normal), Tumor=unique(tumor))   ),
text.scale = 1.5 , mb.ratio= c(0.6,0.4))
}
upset_plot( list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N ) )
plot.list =  list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )
ComplexHeatmap::list_to_matrix(   plot.list           )
class(CRC001N)
CRC001N <- c(as.vector( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Tracking) ) )
class(CRC001N)
CRC001N <- as.vector( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Tracking) )
class(CRC001N)
class(c(CRC001N))
class(unlist(c(CRC001N)))
CRC001N <- unlist ( c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Tracking) )  )
CRC001T <- unlist ( c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Tracking) )  )
CRC003T <- unlist ( c( class.stat %>% filter(Sample %in% c("CRC003T") ) %>% select(Tracking) )  )
CRC006T <- unlist ( c( class.stat %>% filter(Sample %in% c("CRC006T") ) %>% select(Tracking) )  )
CRC007T <- unlist ( c( class.stat %>% filter(Sample %in% c("CRC007T") ) %>% select(Tracking) )  )
CRC008N <- unlist ( c( class.stat %>% filter(Sample %in% c("CRC008N") ) %>% select(Tracking) )  )
CRC010N <- unlist ( c( class.stat %>% filter(Sample %in% c("CRC010N") ) %>% select(Tracking) )  )
class(CRC001N)
plot.list =  list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )
lm <- ComplexHeatmap::list_to_matrix(   plot.list           )
m = ComplexHeatmap::make_comb_mat(lm, remove_complement_set = TRUE, mode = "distinct")
ht = draw(UpSet(m))
od = column_order(ht)
cs = comb_size(m)
decorate_annotation("Intersection\nsize", {
grid.text(cs[od], x = seq_along(cs), y = unit(cs[od], "native") + unit(2, "pt"),
default.units = "native", just = "bottom", gp = gpar(fontsize = 8))
})
upset(  fromList(    list(Normal=unique(normal), Tumor=unique(tumor))   ),
text.scale = 1.5 , mb.ratio= c(0.6,0.4))
plot.list =  list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )
lm <- ComplexHeatmap::list_to_matrix(   plot.list           )
m = ComplexHeatmap::make_comb_mat(lm, remove_complement_set = TRUE, mode = "distinct")
ht = draw(UpSet(m))
od = column_order(ht)
cs = comb_size(m)
decorate_annotation("Intersection\nsize", {
grid.text(cs[od], x = seq_along(cs), y = unit(cs[od], "native") + unit(2, "pt"),
default.units = "native", just = "bottom", gp = gpar(fontsize = 8))
})
upset_plot <- function(plot.list){
#plot.list =  list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )
lm <- ComplexHeatmap::list_to_matrix(   plot.list           )
m = ComplexHeatmap::make_comb_mat(lm, remove_complement_set = TRUE, mode = "distinct")
ht = draw(UpSet(m, text.scale = 1.5 , mb.ratio= c(0.6,0.4) ) )
od = column_order(ht)
cs = comb_size(m)
decorate_annotation("Intersection\nsize", {
grid.text(cs[od], x = seq_along(cs), y = unit(cs[od], "native") + unit(2, "pt"),
default.units = "native", just = "bottom", gp = gpar(fontsize = 8))
})
}
upset_plot( list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N ) )
plot.list =  list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )
lm <- ComplexHeatmap::list_to_matrix(   plot.list           )
m = ComplexHeatmap::make_comb_mat(lm, remove_complement_set = TRUE, mode = "distinct")
UpSet(m, text.scale = 1.5, mb.ratio= c(0.6,0.4) )
UpSet(m)
upset_plot <- function(plot.list){
#plot.list =  list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )
lm <- ComplexHeatmap::list_to_matrix(   plot.list           )
m = ComplexHeatmap::make_comb_mat(lm, remove_complement_set = TRUE, mode = "distinct")
ht = draw( UpSet(m) )
od = column_order(ht)
cs = comb_size(m)
decorate_annotation("Intersection\nsize", {
grid.text(cs[od], x = seq_along(cs), y = unit(cs[od], "native") + unit(2, "pt"),
default.units = "native", just = "bottom", gp = gpar(fontsize = 8))
})
}
upset_plot( list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N ) )
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
text.scale = 1.5 , mb.ratio= c(0.6,0.4))
?upset
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
text.scale = 1.5 , mb.ratio= c(0.6,0.4), mainbar.y.label = "ha")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
text.scale = 1.5 , mb.ratio= c(0.6,0.4), mainbar.y.label = "Overlapping Genes", title = "a")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping Genes", sets.x.label = "Genes")
upset(  fromList(   list(CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping Genes", sets.x.label = "Genes")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N, CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping Genes", sets.x.label = "Genes")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N, CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),  nsets = 7, # how many sample to show
mainbar.y.label = "Overlapping Genes", sets.x.label = "Genes")
upset(  fromList(   list(CRC001T=CRC001T, CRC001N=CRC001N )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping Genes", sets.x.label = "Genes")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping Genes", sets.x.label = "Genes")
upset(  fromList(   list(CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping Genes", sets.x.label = "Genes")
upset(  fromList(   list(CRC001T=CRC001T, CRC001N=CRC001N )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping Genes", sets.x.label = "Genes")
upset(  fromList(   list(CRC001T=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Gene) )  ) ,
CRC001N=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Gene) )  ) )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping genes", sets.x.label = "Total gens")
## paired gene
upset(  fromList(   list(CRC001T=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Gene) )  ) ,
CRC001N=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Gene) )  ) )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4), set_size.show = TRUE,
mainbar.y.label = "Overlapping genes", sets.x.label = "Total gens")
## normal group
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.5,0.5),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
## tumor group
upset(  fromList(   list(CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.5,0.5),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
## paired transcript
upset(  fromList(   list(CRC001T=CRC001T, CRC001N=CRC001N )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.5,0.5),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
## paired gene
upset(  fromList(   list(CRC001T=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Gene) )  ) ,
CRC001N=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Gene) )  ) )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.5,0.5), set_size.show = TRUE,
mainbar.y.label = "Overlapping genes", sets.x.label = "Total gens")
## all
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N, CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.5,0.5),  nsets = 7, # how many sample to show
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
## paired gene
upset(  fromList(   list(CRC001T=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Gene) )  ) ,
CRC001N=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Gene) )  ) )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.5,0.5), set_size.show = TRUE,
mainbar.y.label = "Overlapping genes", sets.x.label = "Total gens")
## paired gene
upset(  fromList(   list(CRC001T=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Gene) )  ) ,
CRC001N=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Gene) )  ) )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4), set_size.show = TRUE,
mainbar.y.label = "Overlapping genes", sets.x.label = "Total gens")
## paired gene
upset(  fromList(   list(CRC001T=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Gene) )  ) ,
CRC001N=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Gene) )  ) )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4), set_size.show = TRUE,
mainbar.y.label = "Overlappiupset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =7000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.5,0.5),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
## tumor group
upset(  fromList(   list(CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =7000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.4,0.6),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
## paired transcript
upset(  fromList(   list(CRC001T=CRC001T, CRC001N=CRC001N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =7000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.4,0.6),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
## paired gene
upset(  fromList(   list(CRC001T=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Gene) )  ) ,
CRC001N=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Gene) )  ) )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.4,0.6), set_size.scale_max =7000, set_size.show = TRUE,
mainbar.y.label = "Overlapping genes", sets.x.label = "Total gens")
## all
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N, CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =7000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.4,0.6),  nsets = 7, # how many sample to show
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
ng genes", sets.x.label = "Total gens")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =7000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.5,0.5),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =9000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.5,0.5),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =10000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.5,0.5),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =12000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.5,0.5),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =11000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.5,0.5),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =11000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.4,0.6),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =11000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
## tumor group
upset(  fromList(   list(CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =10000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
## tumor group
upset(  fromList(   list(CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =11000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping transcripts", sets.x.label = "Total transcripts")
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =11000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping isoforms", sets.x.label = "Total isoforms")
## normal group
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =11000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping isoforms", sets.x.label = "Total isoforms")
## tumor group
upset(  fromList(   list(CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =11000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping isoforms", sets.x.label = "Total isoforms")
## paired transcript
upset(  fromList(   list(CRC001T=CRC001T, CRC001N=CRC001N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =10000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping isoforms", sets.x.label = "Total isoforms")
## paired gene
upset(  fromList(   list(CRC001T=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Gene) )  ) ,
CRC001N=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Gene) )  ) )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4), set_size.scale_max =10000, set_size.show = TRUE,
mainbar.y.label = "Overlapping genes", sets.x.label = "Total gens")
## all
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N, CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =10000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.4,0.6),  nsets = 7, # how many sample to show
mainbar.y.label = "Overlapping isoforms", sets.x.label = "Total isoforms")
## paired gene
upset(  fromList(   list(CRC001T=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001T") ) %>% select(Gene) )  ) ,
CRC001N=unlist ( c( class.stat %>% filter(Sample %in% c("CRC001N") ) %>% select(Gene) )  ) )  ),
keep.order = TRUE, point.size = 2.2,
text.scale = 1.5 , mb.ratio= c(0.6,0.4), set_size.scale_max =10000, set_size.show = TRUE,
mainbar.y.label = "Overlapping genes", sets.x.label = "Total genes")
upset(  fromList(   list(CRC001T=CRC001T, CRC001N=CRC001N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =10000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping isoforms", sets.x.label = "Total isoforms")
## normal group
upset(  fromList(   list(CRC001N=CRC001N, CRC008N=CRC008N, CRC010N=CRC010N )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =11000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping isoforms", sets.x.label = "Total isoforms")
## tumor group
upset(  fromList(   list(CRC001T=CRC001T, CRC003T=CRC003T, CRC006T=CRC006T, CRC007T=CRC007T )  ),
keep.order = TRUE, point.size = 2.2, set_size.scale_max =11000, set_size.show = TRUE,
text.scale = 1.5 , mb.ratio= c(0.6,0.4),
mainbar.y.label = "Overlapping isoforms", sets.x.label = "Total isoforms")
.libPaths(c("/data/cache/zhongxu/R"))
knitr::opts_chunk$set(echo = F, warning = F, message = F, fig.pos = 'H', cache = T)
smp.names = c("CRC001N", "CRC008N", "CRC010N", "CRC001T", "CRC003T", "CRC006T", "CRC007T")
dpsi.cutoff = 0.4
pval.cutoff = 0.005
tpm.cutoff = 5
# dpsi.cutoff = 0
# pval.cutoff = 0.05
# tpm.cutoff = 0
isoform.final.table <- get.final.suppa.table(sample.names = smp.names,
dpsi = "analysis/05suppa/diffSplice.isoform.dpsi.temp.0",
psi  = "analysis/05suppa/diffSplice.isoform.psivec",
event.tmp = "analysis/05suppa/diffSplice.isoform_avglogtpm.tab",
dpsi.cutoff = dpsi.cutoff, tpm.cutoff = tpm.cutoff, pval.cutoff = pval.cutoff)
isoform.final.table$Name <- gsub(";ALL-",";",isoform.final.table$Name)
isoform.final.table$Isoform <- gsub("ALL-","",isoform.final.table$Isoform)
library(scales)
library(ggplot2)
#### isoform
p <- ggplot(isoform.final.table, aes(x=dPSI, y=log10pval, color=sig))
p + geom_point() +
geom_vline(xintercept=c(-dpsi.cutoff,dpsi.cutoff), linetype="solid", size=0.3) +
geom_hline(yintercept=-log10(pval.cutoff), size=0.3) +
xlab(expression(~Delta~PSI)) + ylab("-log10(p-value)") + theme_classic()  +
scale_color_manual(values=c("sig" = "#d00000", "not sig" = "#1d3557", "nan" = "gray80")) +
scale_x_continuous(breaks=pretty_breaks(n=5), limits = c(-1, 1)) + cowplot::theme_cowplot(font_family = "Arial") #+
#scale_y_continuous(breaks=pretty_breaks(n=5), limits = c(0, 5) )
#### isoforms
p <- ggplot(isoform.final.table[isoform.final.table$logRNAc > 0,], aes(x=logRNAc, y=dPSI, color=sig))
p + geom_point() +
scale_color_manual(values=c("sig" = "#d00000", "not sig" = "#1d3557", "nan" = "gray80")) +
labs(title="", x="Average transcript abundance", y=expression(~Delta~PSI))  + theme_classic() + cowplot::theme_cowplot(font_family = "Arial")
candidate.isos <- isoform.final.table %>% filter(sig=="sig")
cat("Total candidate genes", length(unique(candidate.isos$Gene)), "\n",unique(candidate.isos$Gene) ,"\n" )
cat("\n\n------\n",
length(intersect(unique(candidate.isos$Gene), event.final.table$Gene)),
" Genes with definitive AS events: \n",
intersect(unique(candidate.isos$Gene), event.final.table$Gene),"\n")
knitr::kable(candidate.isos)
rm(p)
devtools::document()
devtools::document()
getwd()
getwd()
getwd()
getwd()
devtools::document()
.libPaths("/data/cache/zhongxu/R")
devtools::document()
library(loonR)
?event_pie
library(loonR)
?SuppaGetFinalTable
SuppaGetFinalTable
?SuppaGetFinalTable
??SuppaGetFinalTable
library(loonR)
devtools::load_all(".")
??SuppaGetFinalTable
SuppaEventPie
?SuppaEventPie
library(lloR)
library(loonR)
?SuppaEventPie
devtools::document()
?SuppaEventPie
?SuppaGetFinalTable
devtools::document()
devtools::install_github("ProfessionalFarmer/loonR")
library(loonR)
getwd()
library(loonR)
devtools::document()
library(loonR)
library(loonR)
devtools::document()
library(loonR)
library(loonR)
devtools::document()
library(loonR)
DrawMutationType()
library(loonR)
devtools::install_github("ProfessionalFarmer/loonR")
devtools::install_github("ProfessionalFarmer/loonR",lib="/data/cache/zhongxu/R")
library(loonR)
library(loonR)
library(loonR)
library(loonR)
library(loonR)
library(loonR)
devtools::document()
devtools::document()
library(loonR)
library(loonR)
devtools::document()
devtools::document()
library(loonR)
library(loonR)
library(loonR)
library(loonR)
library(loonR)
library(loonR)
library(loonR)
devtools::document()
library(loonR)
devtools::document()
library(loonR)
devtools::document()
library(loonR)
devtools::document()
devtools::document()
library(loonR)
devtools::document()
library(loonR)
devtools::document()
