library(loonR)
devtools::document()
library(loonR)
decisionCurve.diff.pvalue <- function(outcome, pred1, pred2, boots = 100, xstart=0.01, xstop=0.99, step=0.01, type = "treated", model.name = "Model"){
nbdiff <- function(outcome.infunction, ii, pred1, pred2){
# ii to allow boot() function to select a sample
#cat(ii)
nb1 <- ntbft(outcome.infunction[ii], pred1[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb2 <- ntbft(outcome.infunction[ii], pred1[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb.diff <- as.vector( unlist(nb2[model.name] - nb1[model.name] ) )
cat(".")
return(nb.diff)
}
set.seed(127)
library(boot)
boot.diff <- boot(outcome, statistic = nbdiff,
R = boots, outcome = outcome, pred1 = pred1, pred2 = pre2,
xstart=xstart, xstop=xstop, step=step, type=type)
pvalue<-NULL
for(i in 1:length(boot.diff$t0))
pvalue<-c(pvalue,mean(abs(boot.diff$t[,i]-
boot.diff$t0[i])>abs(boot.diff$t0[i])))
cat("\n","number of significant differences over threshold probabilities",
xstart,"-",xstop,"=",sum(pvalue<=0.05),"\n")
cat("\n","number of non-significant differences over threshold probabilities", xstart,"-",xstop,"=",sum(pvalue>0.05),"\n")
}
pred1 <- as.vector( unlist( LIRI[,c(3)] ) )
data(LIRI)
pred1 <- as.vector( unlist( LIRI[,c(3)] ) )
pred2 <- as.vector( unlist( LIRI[,c(2)] ) )
decisionCurve.diff.pvalue(LIRI$status, pred1, pred2)
boots = 100
xstart=0.01
xstop=0.99
step=0.01
type = "treated"
model.name = "Model"
ii=2
ntbft(LIRI$status[ii], pred1[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
ntbft <- function(response, pred, xstart=0.01, xstop=0.99, step=0.01, type="treated", model.name = "Model", exterdt = NULL){
# https://atm.amegroups.com/article/view/20389/pdf
# For decision curve analysis. not exported
if(length( setdiff(unique(response), c(0,1))) != 0 ){
stop("Response or outcome should be 0 and 1")
}
pt <- seq(from=xstart,to=xstop,by=step)
lpt <- length(pt)
if(type=="treated") coef<-cbind(rep(1,lpt),rep(0,lpt))
if(type=="untreated") coef<-cbind(rep(0,lpt),rep(1,lpt))
if(type=="overall") coef<-cbind(rep(1,lpt),rep(1,lpt))
if(type=="adapt") coef<-cbind(1-pt,pt)
if(!is.null(exterdt)) response <- exterdt
event.rate <- mean(response)
nball  <- event.rate - (1-event.rate) * pt/(1-pt)
nbnone <- 1 - event.rate - event.rate * (1-pt)/pt
# pred and response should be of the same length
N<-length(pred)
nbt<-rep(NA,lpt)
nbu<-rep(NA,lpt)
for(t in 1:lpt){
tp<-sum(pred>=pt[t] & response==1)
fp<-sum(pred>=pt[t] & response==0)
fn<-sum(pred<pt[t] & response==1)
tn<-sum(pred<pt[t] & response==0)
nbt[t]<-tp/N-fp/N*(pt[t]/(1-pt[t]))
nbu[t]<-tn/N-fn/N*((1-pt[t])/pt[t])
}
nb<-data.frame(pt)
names(nb)<-"threshold"
nb["All"]<-coef[,1]*nball
nb["None"]<-coef[,2]*nbnone
nb[model.name]<-coef[,1]*nbt+coef[,2]*nbu
return(nb)
}
ntbft(LIRI$status[ii], pred1[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb2 <- ntbft(outcome.infunction[ii], pred2[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
boots = 100
nbdiff <- function(outcome.infunction, ii, pred1, pred2){
# ii to allow boot() function to select a sample
#cat(ii)
nb1 <- ntbft(outcome.infunction[ii], pred1[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb2 <- ntbft(outcome.infunction[ii], pred2[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb.diff <- as.vector( unlist(nb2[model.name] - nb1[model.name] ) )
cat(".")
return(nb.diff)
}
nbdiff(LIRI$status, pred1, pred2)
pred2 <- as.vector( unlist( LIRI[,c(2)] ) )
nbdiff(LIRI$status, pred1, pred2)
decisionCurve.diff.pvalue <- function(outcome, pred1, pred2, boots = 100, xstart=0.01, xstop=0.99, step=0.01, type = "treated", model.name = "Model"){
nbdiff <- function(outcome.infunction, ii, pred1, pred2){
# ii to allow boot() function to select a sample
#cat(ii)
nb1 <- ntbft(outcome.infunction[ii], pred1[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb2 <- ntbft(outcome.infunction[ii], pred2[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb.diff <- as.vector( unlist(nb2[model.name] - nb1[model.name] ) )
cat(".")
return(nb.diff)
}
set.seed(127)
library(boot)
boot.diff <- boot(outcome, statistic = nbdiff,
R = boots, outcome = outcome, pred1 = pred1, pred2 = pred2,
xstart=xstart, xstop=xstop, step=step, type=type)
pvalue<-NULL
for(i in 1:length(boot.diff$t0))
pvalue<-c(pvalue,mean(abs(boot.diff$t[,i]-
boot.diff$t0[i])>abs(boot.diff$t0[i])))
cat("\n","number of significant differences over threshold probabilities",
xstart,"-",xstop,"=",sum(pvalue<=0.05),"\n")
cat("\n","number of non-significant differences over threshold probabilities", xstart,"-",xstop,"=",sum(pvalue>0.05),"\n")
}
nbdiff(LIRI$status, pred1, pred2)
decisionCurve.diff.pvalue <- function(outcome, pred1, pred2, boots = 100, xstart=0.01, xstop=0.99, step=0.01, type = "treated", model.name = "Model"){
nbdiff <- function(outcome.infunction, ii, pred1, pred2){
# ii to allow boot() function to select a sample
#cat(ii)
nb1 <- ntbft(outcome.infunction[ii], pred1[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb2 <- ntbft(outcome.infunction[ii], pred2[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb.diff <- as.vector( unlist(nb2[model.name] - nb1[model.name] ) )
cat(".")
return(nb.diff)
}
set.seed(127)
library(boot)
boot.diff <- boot(outcome, statistic = nbdiff,
R = boots, outcome = outcome, pred1 = pred1, pred2 = pred2,
xstart=xstart, xstop=xstop, step=step, type=type)
pvalue<-NULL
for(i in 1:length(boot.diff$t0))
pvalue<-c(pvalue,mean(abs(boot.diff$t[,i]-
boot.diff$t0[i])>abs(boot.diff$t0[i])))
cat("\n","number of significant differences over threshold probabilities",
xstart,"-",xstop,"=",sum(pvalue<=0.05),"\n")
cat("\n","number of non-significant differences over threshold probabilities", xstart,"-",xstop,"=",sum(pvalue>0.05),"\n")
}
nbdiff(LIRI$status, pred1, pred2)
nbdiff <- function(outcome.infunction, ii, pred1, pred2){
# ii to allow boot() function to select a sample
#cat(ii)
nb1 <- ntbft(outcome.infunction[ii], pred1[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb2 <- ntbft(outcome.infunction[ii], pred2[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb.diff <- as.vector( unlist(nb2[model.name] - nb1[model.name] ) )
cat(".")
return(nb.diff)
}
nbdiff(LIRI$status, 1ï¼Œpred1, pred2)
nbdiff(LIRI$status, 1,pred1, pred2)
nbdiff(LIRI$status, 2,pred1, pred2)
nbdiff(LIRI$status, 3, pred1, pred2)
nbdiff(LIRI$status, 4, pred1, pred2)
nbdiff(LIRI$status, 5, pred1, pred2)
type
step
boot(outcome, statistic = nbdiff,
R = boots, outcome = outcome, pred1 = pred1, pred2 = pred2,
xstart=xstart, xstop=xstop, step=step, type=type)
boot(LIRI$status, statistic = nbdiff,
R = boots, outcome = outcome, pred1 = pred1, pred2 = pred2,
xstart=xstart, xstop=xstop, step=step, type=type)
boot(LIRI$status, statistic = nbdiff,
R = 100, outcome = outcome, pred1 = pred1, pred2 = pred2,
xstart=xstart, xstop=xstop, step=step, type=type)
boot(LIRI$status, statistic = nbdiff,
R = 100, outcome = outcome, pred1 = pred1, pred2 = pred2)
boot.diff <- boot(outcome, statistic = nbdiff,
R = boots, pred1 = pred1, pred2 = pred2)
boot.diff <- boot(LIRI$status, statistic = nbdiff,
R = boots, pred1 = pred1, pred2 = pred2)
boot.diff <- boot(LIRI$status, statistic = nbdiff,
R = 10, pred1 = pred1, pred2 = pred2)
pvalue<-NULL
for(i in 1:length(boot.diff$t0))
pvalue<-c(pvalue,mean(abs(boot.diff$t[,i]-
boot.diff$t0[i])>abs(boot.diff$t0[i])))
cat("\n","number of significant differences over threshold probabilities",
xstart,"-",xstop,"=",sum(pvalue<=0.05),"\n")
cat("\n","number of non-significant differences over threshold probabilities", xstart,"-",xstop,"=",sum(pvalue>0.05),"\n")
decisionCurve.diff.pvalue <- function(outcome, pred1, pred2, boots = 100, xstart=0.01, xstop=0.99, step=0.01, type = "treated", model.name = "Model"){
nbdiff <- function(outcome.infunction, ii, pred1, pred2){
# ii to allow boot() function to select a sample
#cat(ii)
nb1 <- ntbft(outcome.infunction[ii], pred1[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb2 <- ntbft(outcome.infunction[ii], pred2[ii],
xstart=xstart, xstop=xstop,
step=step, type=type, model.name = model.name)
nb.diff <- as.vector( unlist(nb2[model.name] - nb1[model.name] ) )
cat(".")
return(nb.diff)
}
set.seed(127)
library(boot)
boot.diff <- boot(outcome, statistic = nbdiff,
R = boots, pred1 = pred1, pred2 = pred2)
pvalue<-NULL
for(i in 1:length(boot.diff$t0))
pvalue<-c(pvalue,mean(abs(boot.diff$t[,i]-
boot.diff$t0[i])>abs(boot.diff$t0[i])))
cat("\n","number of significant differences over threshold probabilities",
xstart,"-",xstop,"=",sum(pvalue<=0.05),"\n")
cat("\n","number of non-significant differences over threshold probabilities", xstart,"-",xstop,"=",sum(pvalue>0.05),"\n")
}
decisionCurve.diff.pvalue(LIRI$status, pred1, pred2)
devtools::document()
devtools::document()
devtools::document()
rm(decisionCurve.diff.pvalue())
rm(decisionCurve.diff.pvalue)
rm(ntbft)
devtools::document()
library(loonR)
data(LIRI)
pred <- as.vector( unlist( LIRI[,c(3)] ) )
decisionCurveAnalysisSimple(LIRI$status, pred)
decisionCurveAnalysisSimple(LIRI$status, as.vector( unlist( LIRI[,c(2)] ) ))
decisionCurveAnalysisSimple(LIRI$status, as.vector( unlist( LIRI[,c(2)] ) ), model.name = "a")
devtools::document()
library(loonR)
devtools::document()
library(loonR)
